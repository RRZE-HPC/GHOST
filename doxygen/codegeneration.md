Code generation
===============

GHOST comes with a simple code generator consisting of several perl scripts which are located in `bin/`.
The main preprocessing script `/bin/ghost_pp.pl` duplication of code lines (`GHOST_UNROLL`) and the generation of function variants (`GHOST_FUNC_BEGIN/END`).
The latter mechanism works similar to C++ function templates.
However, C++ function templates cannot be used here because they would not work together with `GHOST_UNROLL` (e.g. if the unrolling size depends on a template parameters).

In addition, a header file containg prototypes of all generated functions is generated by `bin/ghost_extractfunc.pl`.

Lastly, the script `bin/ghost_mapfunc.pl` creates a .def file which should be included in a GHOST source file.
In this .def file, all generated kernels are inserted into a map for easy lookup.

GHOST_FUNC_BEGIN/END
--------------------

This macro is used for the generation of function variants with one or more parameters.
In GHOST, the generation of block vector kernels with fixed block sizes and the generation of SpMV kernels with fixed chunk heights for the SELL matrix are done with this mechanism. 

Example: A file containing
~~~{.c}
#GHOST_FUNC_BEGIN#FOO=1,2#BAR=5,6
int func_FOO_BAR(void) {
    return FOO+BAR;
}
#GHOST_FUNC_END
~~~
would result in the generation of the following file:
~~~{.c}
int func_1_5(void) {
    return 1+5;
}

int func_2_5(void) {
    return 2+5;
}

int func_1_6(void) {
    return 1+6;
}

int func_2_6(void) {
    return 2+6;
}
~~~

GHOST_UNROLL
------------

This macro is used in the intrinsics implementation of compute kernels.
The code line to be duplicated has to start with `#GHOST_UNROLL#`. After that, the actual code follows in a single line.
Everything that should be substituted with a serial index has to be an "@" sign.
After the code line, another "#" followed with by the unroll size has to be specified.

Example:
~~~{.c}
#GHOST_UNROLL#int bla@ = @*4;#4
~~~
would result in the following code after preprocessing:
~~~{.c}
int bla0 = 0*4;
int bla1 = 1*4;
int bla2 = 2*4;
int bla3 = 3*4;
~~~
